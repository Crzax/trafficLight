C51 COMPILER V9.60.7.0   IR                                                                11/01/2024 22:45:59 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE IR
OBJECT MODULE PLACED IN .\Objects\IR.obj
COMPILER INVOKED BY: D:\Developer\Keil_5\C51\BIN\C51.EXE IR.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listin
                    -gs\IR.lst) OBJECT(.\Objects\IR.obj)

line level    source

   1          /**************************************************
   2           * Author:       ÈôàÈúáÈõÑ
   3           * Date:         2024-10-31
   4           * Description:  Á∫¢Â§ñÈÅ•ÊéßÂô®Áõ∏ÂÖ≥
   5           **************************************************/
   6          
   7          #include <REGX52.H>
   8          #include "Timer.h"
   9          #include "Int0.h"
  10          #include "IR.h"
  11          #include "TrafficLight.h"
  12          unsigned int IR_Time;
  13          unsigned char IR_State;
  14          
  15          unsigned char IR_Data[4];
  16          unsigned char IR_pData;
  17          
  18          unsigned char IR_DataFlag;  
  19          unsigned char IR_RepeatFlag;
  20          unsigned char IR_Address;
  21          unsigned char IR_Command;
  22          
  23          /**
  24            * @brief  ÈÅ•ÊéßÂô®ÂàùÂßãÂåñ
  25            * @param  Êó†
  26            * @retval Êó†
  27            */
  28          void IR_Init(void)
  29          {
  30   1              Timer1_Init();
  31   1              Int0_Init();
  32   1      }
  33          
  34          /**
  35            * @brief  Ëé∑Âèñdata‰ΩçÔºåÂà§Êñ≠ÊòØÂê¶ÊãøÂà∞‰∫ÜÊï∞ÊçÆ
  36            * @param  Êó†
  37            * @retval dataFlag
  38            */
  39          unsigned char IR_GetDataFlag(void)
  40          {
  41   1              if(IR_DataFlag)
  42   1              {
  43   2                      IR_DataFlag=0;
  44   2                      return 1;
  45   2              }
  46   1              return 0;
  47   1      }
  48          
  49          /**
  50            * @brief  Á∫¢Â§ñÈÅ•ÊéßËé∑ÂèñÊî∂Âà∞ÁöÑÂëΩ‰ª§Êï∞ÊçÆ
  51            * @param  Êó†
  52            * @retval Êî∂Âà∞ÁöÑÂëΩ‰ª§Êï∞ÊçÆ
  53            */
  54          unsigned char IR_GetCommand(void)
C51 COMPILER V9.60.7.0   IR                                                                11/01/2024 22:45:59 PAGE 2   

  55          {
  56   1              return IR_Command;
  57   1      }
  58          
  59          /**
  60            * @brief  Ëé∑ÂèñÁõÆÂâçÁöÑCommandÊâÄÊåáÁöÑÊï∞Â≠ó/Êåá‰ª§
  61            * @param  Êó†
  62            * @retval ÂΩìÂâçCommandÂØπÂ∫îÁöÑÊï∞Â≠ó/Êåá‰ª§ÔºåÂ¶ÇÊûú‰∏çÊòØÂ∑≤ÁªèÂÆö‰πâÂê´‰πâÁöÑÊï∞Â≠ó/Êåá‰ª§ÔºåÈÇ£‰πàË
             -øîÂõûINVALID
  63                                  ÂêåÊó∂ËøîÂõûÂêéÁΩÆIR_Command‰∏∫0
  64            */
  65          unsigned char IR_GetNumber(void)
  66          {
  67   1              switch (IR_Command) {
  68   2                      case IR_0: IR_Command = 0; return 0;break;
  69   2                      case IR_1: IR_Command = 0; return 1;break;
  70   2                      case IR_2: IR_Command = 0; return 2;break;
  71   2                      case IR_3: IR_Command = 0; return 3;break;
  72   2                      case IR_4: IR_Command = 0; return 4;break;
  73   2                      case IR_5: IR_Command = 0; return 5;break;
  74   2                      case IR_6: IR_Command = 0; return 6;break;
  75   2                      case IR_7: IR_Command = 0; return 7;break;
  76   2                      case IR_8: IR_Command = 0; return 8;break;
  77   2                      case IR_9: IR_Command = 0; return 9;break;
  78   2                      case IR_VOL_ADD: IR_Command = 0; return ADDONE;break;
  79   2                      case IR_VOL_MINUS: IR_Command = 0; return SUBONE;break;
  80   2                      case IR_MUTE: IR_Command = 0; return CLEAR;break;
  81   2                      case IR_EQ: IR_Command = 0; return OK;break;
  82   2                      default: IR_Command = 0;return INVALID;
  83   2              }
  84   1      }
  85          
  86          /**
  87            * @brief  Â§ñÈÉ®‰∏≠Êñ≠0ÁöÑÂ§ÑÁêÜÂáΩÊï∞Ôºå‰πüÊòØÁ∫¢Â§ñÈÅ•ÊéßÂô®ÁöÑËß£Á†ÅÂáΩÊï∞Ôºå‰ΩøÁî®Áä∂ÊÄÅÊú∫ÁöÑÂéüÁêÜ
  88            * @param  Êó†
  89            * @retval Êó†
  90            */
  91          void Int0_Routine(void) interrupt 0
  92          {
  93   1              if (IR_State==0)
  94   1              {
  95   2                      Timer1_SetCounter(0);
  96   2                      Timer1_Run(1);
  97   2                      IR_State = 1;
  98   2              }
  99   1              else if(IR_State==1)            //Áä∂ÊÄÅ1ÔºåÁ≠âÂæÖStart‰ø°Âè∑ÊàñRepeat‰ø°Âè∑
 100   1              {
 101   2                      IR_Time=Timer1_GetCounter();    //Ëé∑Âèñ‰∏ä‰∏ÄÊ¨°‰∏≠Êñ≠Âà∞Ê≠§Ê¨°‰∏≠Êñ≠ÁöÑÊó∂Èó¥
 102   2                      Timer1_SetCounter(0);   //ÂÆöÊó∂ËÆ°Êï∞Âô®Ê∏Ö0
 103   2                      //Â¶ÇÊûúËÆ°Êó∂‰∏∫13.5msÔºåÂàôÊé•Êî∂Âà∞‰∫ÜStart‰ø°Âè∑ÔºàÂà§ÂÆöÂÄºÂú®12MHzÊô∂ÊåØ‰∏ã‰∏∫13500ÔºåÂú®11.0592MH
             -zÊô∂ÊåØ‰∏ã‰∏∫12442Ôºâ
 104   2                      if(IR_Time>12442-500 && IR_Time<12442+500)
 105   2                      {
 106   3                              IR_State=2;                     //ÁΩÆÁä∂ÊÄÅ‰∏∫2
 107   3                      }
 108   2                      //Â¶ÇÊûúËÆ°Êó∂‰∏∫11.25msÔºåÂàôÊé•Êî∂Âà∞‰∫ÜRepeat‰ø°Âè∑ÔºàÂà§ÂÆöÂÄºÂú®12MHzÊô∂ÊåØ‰∏ã‰∏∫11250ÔºåÂú®11.0592
             -MHzÊô∂ÊåØ‰∏ã‰∏∫10368Ôºâ
 109   2                      else if(IR_Time>10368-500 && IR_Time<10368+500)
 110   2                      {
 111   3                              IR_RepeatFlag=1;        //ÁΩÆÊî∂Âà∞ËøûÂèëÂ∏ßÊ†áÂøó‰Ωç‰∏∫1
 112   3                              Timer1_Run(0);          //ÂÆöÊó∂Âô®ÂÅúÊ≠¢
 113   3                              IR_State=0;                     //ÁΩÆÁä∂ÊÄÅ‰∏∫0
C51 COMPILER V9.60.7.0   IR                                                                11/01/2024 22:45:59 PAGE 3   

 114   3                      }
 115   2                      else                                    //Êé•Êî∂Âá∫Èîô
 116   2                      {
 117   3                              IR_State=1;                     //ÁΩÆÁä∂ÊÄÅ‰∏∫1
 118   3                      }
 119   2              }
 120   1              else if(IR_State==2)            //Áä∂ÊÄÅ2ÔºåÊé•Êî∂Êï∞ÊçÆ
 121   1              {
 122   2                      IR_Time=Timer1_GetCounter();    //Ëé∑Âèñ‰∏ä‰∏ÄÊ¨°‰∏≠Êñ≠Âà∞Ê≠§Ê¨°‰∏≠Êñ≠ÁöÑÊó∂Èó¥
 123   2                      Timer1_SetCounter(0);   //ÂÆöÊó∂ËÆ°Êï∞Âô®Ê∏Ö0
 124   2                      //Â¶ÇÊûúËÆ°Êó∂‰∏∫1120usÔºåÂàôÊé•Êî∂Âà∞‰∫ÜÊï∞ÊçÆ0ÔºàÂà§ÂÆöÂÄºÂú®12MHzÊô∂ÊåØ‰∏ã‰∏∫1120ÔºåÂú®11.0592MHzÊô∂Ê
             -åØ‰∏ã‰∏∫1032Ôºâ
 125   2                      if(IR_Time>1032-500 && IR_Time<1032+500)
 126   2                      {
 127   3                              IR_Data[IR_pData/8]&=~(0x01<<(IR_pData%8));     //Êï∞ÊçÆÂØπÂ∫î‰ΩçÊ∏Ö0
 128   3                              IR_pData++;                     //Êï∞ÊçÆ‰ΩçÁΩÆÊåáÈíàËá™Â¢û
 129   3                      }
 130   2                      //Â¶ÇÊûúËÆ°Êó∂‰∏∫2250usÔºåÂàôÊé•Êî∂Âà∞‰∫ÜÊï∞ÊçÆ1ÔºàÂà§ÂÆöÂÄºÂú®12MHzÊô∂ÊåØ‰∏ã‰∏∫2250ÔºåÂú®11.0592MHzÊô∂Ê
             -åØ‰∏ã‰∏∫2074Ôºâ
 131   2                      else if(IR_Time>2074-500 && IR_Time<2074+500)
 132   2                      {
 133   3                              IR_Data[IR_pData/8]|=(0x01<<(IR_pData%8));      //Êï∞ÊçÆÂØπÂ∫î‰ΩçÁΩÆ1
 134   3                              IR_pData++;                     //Êï∞ÊçÆ‰ΩçÁΩÆÊåáÈíàËá™Â¢û
 135   3                      }
 136   2                      else                                    //Êé•Êî∂Âá∫Èîô
 137   2                      {
 138   3                              IR_pData=0;                     //Êï∞ÊçÆ‰ΩçÁΩÆÊåáÈíàÊ∏Ö0
 139   3                              IR_State=1;                     //ÁΩÆÁä∂ÊÄÅ‰∏∫1
 140   3                      }
 141   2                      if(IR_pData>=32)                //Â¶ÇÊûúÊé•Êî∂Âà∞‰∫Ü32‰ΩçÊï∞ÊçÆ
 142   2                      {
 143   3                              IR_pData=0;                     //Êï∞ÊçÆ‰ΩçÁΩÆÊåáÈíàÊ∏Ö0
 144   3                              if((IR_Data[0]==~IR_Data[1]) && (IR_Data[2]==~IR_Data[3]))      //Êï∞ÊçÆÈ™åËØÅ
 145   3                              {
 146   4                                      IR_Address=IR_Data[0];  //ËΩ¨Â≠òÊï∞ÊçÆ
 147   4                                      IR_Command=IR_Data[2];
 148   4                                      IR_DataFlag=1;  //ÁΩÆÊî∂Âà∞ËøûÂèëÂ∏ßÊ†áÂøó‰Ωç‰∏∫1
 149   4                              }
 150   3                              Timer1_Run(0);          //ÂÆöÊó∂Âô®ÂÅúÊ≠¢
 151   3                              IR_State=0;                     //ÁΩÆÁä∂ÊÄÅ‰∏∫0
 152   3                      }
 153   2              }
 154   1      }
 155          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    492    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     12    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
